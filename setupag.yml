---
- name: Configurar MOTD e pacotes b√°sicos
  hosts: all
  become: true

  tasks:

    - name: Instalar pacotes necess√°rios
      yum:
        name:
          - open-vm-tools
          - vim
        state: present

    - name: Criar MOTD simples em /etc/profile.d/motd.sh
      copy:
        dest: /etc/profile.d/motd.sh
        owner: root
        group: root
        mode: '0755'
        content: |
          #!/bin/bash

          [[ -n "$MOTD_SHOWN" ]] && return
          export MOTD_SHOWN=1

          if [[ "$USER" == "suporte" || "$USER" == "root" ]]; then
              echo "===================================="
              echo " üñ•Ô∏è Servidor: $(hostname)"
              echo " üìÖ Data: $(date)"
              echo " ‚è≥ Uptime: $(uptime -p)"
              echo " üìä Usu√°rios logados: $(who | wc -l)"
              echo " üåê Espa√ßo livre no disco: $(df -h / | tail -1 | awk '{print $4}')"
              echo "===================================="
          fi

    - name: Rebootar o servidor
      reboot:
        msg: "Reboot autom√°tico via AWX ap√≥s configura√ß√£o"
        reboot_timeout: 600
        pre_reboot_delay: 5
        post_reboot_delay: 20
        test_command: whoami
